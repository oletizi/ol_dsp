<!-- Generated by SpecStory -->

# 2025-10-07 23:58:00Z

<!-- Claude Code Session 83d74a9b-1eea-4e11-abd9-d5ed65f31bc1 (2025-10-07_23-58-00Z) -->

_**User**_

Analyze these staged git changes and output ONLY a single-line conventional commit message (type(scope): description). No explanations.
diff --git a/modules/juce/midi-server/NetworkMidiServer.cpp b/modules/juce/midi-server/NetworkMidiServer.cpp
index bf4e3a2..a91cb87 100644
--- a/modules/juce/midi-server/NetworkMidiServer.cpp
+++ b/modules/juce/midi-server/NetworkMidiServer.cpp
@@ -1273,6 +1273,78 @@ private:
     std::map<juce::String, uint16_t> inputDeviceMap;
 };
 
+//==============================================================================
+// Command-line argument parsing structure
+struct CommandLineOptions
+{
+    juce::String nodeId;
+    int port = 0;
+    bool showHelp = false;
+    bool hasError = false;
+    juce::String errorMessage;
+
+    bool parseArguments(int argc, char* argv[]) {
+        for (int i = 1; i < argc; ++i) {
+            juce::String arg(argv[i]);
+
+            if (arg == "--help" || arg == "-h") {
+                showHelp = true;
+                return true;
+            }
+
+            if (arg.startsWith("--node-id=")) {
+                nodeId = arg.substring(10);
+                if (nodeId.isEmpty()) {
+                    hasError = true;
+                    errorMessage = "Error: --node-id argument requires a UUID value";
+                    return false;
+                }
+                // Validate UUID format
+                juce::Uuid testUuid(nodeId);
+                if (testUuid.isNull()) {
+                    hasError = true;
+                    errorMessage = "Error: Invalid UUID format for --node-id: " + nodeId;
+                    return false;
+                }
+            }
+            else if (arg.startsWith("--port=")) {
+                juce::String portStr = arg.substring(7);
+                if (portStr.isEmpty()) {
+                    hasError = true;
+                    errorMessage = "Error: --port argument requires a numeric value";
+                    return false;
+                }
+
+                port = portStr.getIntValue();
+                if (port < 1024 || port > 65535) {
+                    hasError = true;
+                    errorMessage = "Error: Port must be in range 1024-65535, got: " + juce::String(port);
+                    return false;
+                }
+            }
+            else {
+                hasError = true;
+                errorMessage = "Error: Unknown argument: " + arg;
+                return false;
+            }
+        }
+        return true;
+    }
+
+    void printUsage() const {
+        std::cout << "\nUsage: network_midi_server [OPTIONS]\n\n";
+        std::cout << "Options:\n";
+        std::cout << "  --node-id=<uuid>    Override auto-generated node UUID\n";
+        std::cout << "                      Example: --node-id=\"a1b2c3d4-e5f6-7890-1234-567890abcdef\"\n";
+        std::cout << "  --port=<number>     Use specific HTTP port (1024-65535)\n";
+        std::cout << "                      Example: --port=8001\n";
+        std::cout << "  --help, -h          Show this help message\n\n";
+        std::cout << "If no arguments are provided, the server will:\n";
+        std::cout << "  - Auto-generate a unique node UUID\n";
+        std::cout << "  - Auto-assign an available HTTP port\n\n";
+    }
+};
+
 //==============================================================================
 int main(int argc, char* argv[])
 {
@@ -1282,9 +1354,29 @@ int main(int argc, char* argv[])
     std::cout << "\nNetwork MIDI Server v1.0 - Full Mesh Integration" << std::endl;
     std::cout << "=================================================" << std::endl;
 
-    // Initialize node identity (each instance gets a unique UUID)
+    // Parse command-line arguments
+    CommandLineOptions options;
+    if (!options.parseArguments(argc, argv)) {
+        std::cerr << "\n" << options.errorMessage.toStdString() << "\n";
+        options.printUsage();
+        return 1;
+    }
+
+    if (options.showHelp) {
+        options.printUsage();
+        return 0;
+    }
+
+    // Initialize node identity
     NetworkMidi::NodeIdentity identity;
 
+    // Override node ID if specified via CLI
+    if (options.nodeId.isNotEmpty()) {
+        juce::Uuid customUuid(options.nodeId);
+        std::cout << "\nUsing CLI-specified node ID: " << customUuid.toString().toStdString() << std::endl;
+        identity = NetworkMidi::NodeIdentity::createWithUuid(customUuid);
+    }
+
     // Initialize instance manager (creates lock file and temp directory)
     std::unique_ptr<NetworkMidi::InstanceManager> instanceManager;
     try {
@@ -1295,30 +1387,32 @@ int main(int argc, char* argv[])
         return 1;
     }
 
-    // Parse port from command line (0 = auto-assign)
-    int port = 0;
-    if (argc > 1) {
-        port = std::atoi(argv[1]);
-    }
-
     std::cout << "\nStarting server..." << std::endl;
-    if (port == 0) {
+    if (options.port == 0) {
         std::cout << "  HTTP Port: auto-assigned" << std::endl;
     } else {
-        std::cout << "  HTTP Port: " << port << std::endl;
+        std::cout << "  HTTP Port: " << options.port << " (CLI-specified)" << std::endl;
     }
 
-    NetworkMidiServer server(identity, instanceManager.get(), port);
+    NetworkMidiServer server(identity, instanceManager.get(), options.port);
     server.startServer();
 
     int actualPort = server.getActualPort();
     int udpPort = server.getUdpPort();
 
     std::cout << "\nServer running:" << std::endl;
-    std::cout << "  HTTP Port: " << actualPort << std::endl;
+    std::cout << "  HTTP Port: " << actualPort;
+    if (options.port != 0) {
+        std::cout << " (CLI-specified)";
+    }
+    std::cout << std::endl;
     std::cout << "  UDP Port: " << udpPort << std::endl;
     std::cout << "  Node: " << identity.getNodeName().toStdString() << std::endl;
-    std::cout << "  UUID: " << identity.getNodeId().toString().toStdString() << std::endl;
+    std::cout << "  UUID: " << identity.getNodeId().toString().toStdString();
+    if (options.nodeId.isNotEmpty()) {
+        std::cout << " (CLI-specified)";
+    }
+    std::cout << std::endl;
     std::cout << "  Instance dir: " << instanceManager->getInstanceDirectory()
                                        .getFullPathName().toStdString() << std::endl;
 
diff --git a/modules/juce/midi-server/network/core/NodeIdentity.cpp b/modules/juce/midi-server/network/core/NodeIdentity.cpp
index b7b1803..816d4d0 100644
--- a/modules/juce/midi-server/network/core/NodeIdentity.cpp
+++ b/modules/juce/midi-server/network/core/NodeIdentity.cpp
@@ -63,6 +63,30 @@ NodeIdentity::NodeIdentity(const juce::String& configPath)
     std::cout << "  Hostname: " << hostname.toStdString() << std::endl;
 }
 
+// Private constructor for custom UUID
+NodeIdentity::NodeIdentity(const juce::Uuid& customUuid, bool /*tag*/)
+    : nodeId(customUuid)
+{
+    // Get system hostname
+    hostname = juce::SystemStats::getComputerName();
+    if (hostname.isEmpty()) {
+        hostname = "unknown-host";
+    }
+
+    nodeName = generateNodeName(nodeId);
+
+    std::cout << "Node Identity initialized (custom UUID):" << std::endl;
+    std::cout << "  UUID: " << nodeId.toString().toStdString() << std::endl;
+    std::cout << "  Name: " << nodeName.toStdString() << std::endl;
+    std::cout << "  Hostname: " << hostname.toStdString() << std::endl;
+}
+
+// Static factory method for custom UUID
+NodeIdentity NodeIdentity::createWithUuid(const juce::Uuid& customUuid)
+{
+    return NodeIdentity(customUuid, true);
+}
+
 juce::Uuid NodeIdentity::getNodeId() const
 {
     return nodeId;
diff --git a/modules/juce/midi-server/network/core/NodeIdentity.h b/modules/juce/midi-server/network/core/NodeIdentity.h
index 7951cfa..9f49a24 100644
--- a/modules/juce/midi-server/network/core/NodeIdentity.h
+++ b/modules/juce/midi-server/network/core/NodeIdentity.h
@@ -38,6 +38,13 @@ public:
      */
     explicit NodeIdentity(const juce::String& configDir);
 
+    /**
+     * Create a node identity with a specific UUID.
+     * Used for testing and integration scenarios where the UUID
+     * must be controlled externally.
+     */
+    static NodeIdentity createWithUuid(const juce::Uuid& customUuid);
+
     /**
      * Get the unique node UUID.
      * This UUID is persistent across restarts.
@@ -70,6 +77,10 @@ public:
     ~NodeIdentity() = default;
 
 private:
+    /**
+     * Private constructor for creating identity with custom UUID.
+     */
+    NodeIdentity(const juce::Uuid& customUuid, bool /*tag*/);
 
     /**
      * Load existing UUID from disk, or create new one if not found.
diff --git a/modules/juce/midi-server/tests/integration/multihop_context_test.sh b/modules/juce/midi-server/tests/integration/multihop_context_test.sh
old mode 100644
new mode 100755


---

_**Agent (claude-sonnet-4-5-20250929)**_

feat(midi-server): add CLI arguments for node-id and port configuration with help documentation

