<!-- Generated by SpecStory -->

# Batch MIDI Mapping Verification Script Automates Checks (2025-10-03 19:28:08Z)

<!-- Claude Code Session 642037ad-9f71-4a90-9453-79779e493f9f (2025-10-03_19-28-08Z) -->

_**User**_

Analyze these staged git changes and output ONLY a single-line conventional commit message (type(scope): description). No explanations.
diff --git a/modules/audio-control/modules/live-max-cc-router/package.json b/modules/audio-control/modules/live-max-cc-router/package.json
index ea1022b..0097752 100644
--- a/modules/audio-control/modules/live-max-cc-router/package.json
+++ b/modules/audio-control/modules/live-max-cc-router/package.json
@@ -32,7 +32,9 @@
     "test": "vitest run",
     "verify-mapping": "node scripts/ai-verify-mapping.cjs",
     "verify-mapping:channev": "node scripts/ai-verify-mapping.cjs ../canonical-midi-maps/maps/novation-launch-control-xl-3/channel-strips/analog-obsession-channev.yaml ../canonical-midi-maps/plugin-descriptors/analogobsession-channev.json",
-    "fix-mapping:channev": "node scripts/ai-verify-mapping.cjs ../canonical-midi-maps/maps/novation-launch-control-xl-3/channel-strips/analog-obsession-channev.yaml ../canonical-midi-maps/plugin-descriptors/analogobsession-channev.json --fix"
+    "fix-mapping:channev": "node scripts/ai-verify-mapping.cjs ../canonical-midi-maps/maps/novation-launch-control-xl-3/channel-strips/analog-obsession-channev.yaml ../canonical-midi-maps/plugin-descriptors/analogobsession-channev.json --fix",
+    "verify-all": "node scripts/verify-all-mappings.cjs",
+    "fix-all": "node scripts/verify-all-mappings.cjs --fix"
   },
   "keywords": [
     "max-for-live",
diff --git a/modules/audio-control/modules/live-max-cc-router/scripts/verify-all-mappings.cjs b/modules/audio-control/modules/live-max-cc-router/scripts/verify-all-mappings.cjs
new file mode 100644
index 0000000..12bc8a5
--- /dev/null
+++ b/modules/audio-control/modules/live-max-cc-router/scripts/verify-all-mappings.cjs
@@ -0,0 +1,224 @@
+#!/usr/bin/env node
+
+const fs = require('fs');
+const path = require('path');
+const { execSync } = require('child_process');
+
+/**
+ * Verify all canonical MIDI mappings in batch
+ *
+ * Usage: node verify-all-mappings.cjs [--fix]
+ *
+ * Options:
+ *   --fix    Automatically fix all incorrect mappings
+ */
+
+function findAllMappings() {
+  const mapsDir = path.join(__dirname, '../../canonical-midi-maps/maps');
+  const descriptorsDir = path.join(__dirname, '../../canonical-midi-maps/plugin-descriptors');
+
+  const mappings = [];
+
+  // Recursively find all .yaml files in maps directory
+  function scanDirectory(dir) {
+    const entries = fs.readdirSync(dir, { withFileTypes: true });
+
+    for (const entry of entries) {
+      const fullPath = path.join(dir, entry.name);
+
+      if (entry.isDirectory()) {
+        scanDirectory(fullPath);
+      } else if (entry.isFile() && entry.name.endsWith('.yaml')) {
+        // Try to find corresponding descriptor
+        const descriptor = findDescriptorForMapping(fullPath, descriptorsDir);
+        if (descriptor) {
+          mappings.push({
+            mappingPath: fullPath,
+            descriptorPath: descriptor,
+            name: path.basename(fullPath, '.yaml')
+          });
+        }
+      }
+    }
+  }
+
+  scanDirectory(mapsDir);
+  return mappings;
+}
+
+function findDescriptorForMapping(mappingPath, descriptorsDir) {
+  // Read mapping to get plugin info
+  const yaml = require('yaml');
+  try {
+    const mappingContent = fs.readFileSync(mappingPath, 'utf8');
+    const mapping = yaml.parse(mappingContent);
+
+    // Skip files that don't have plugin info (e.g., registries, templates)
+    if (!mapping.plugin || !mapping.plugin.manufacturer || !mapping.plugin.name) {
+      return null;
+    }
+
+    const manufacturer = mapping.plugin.manufacturer.toLowerCase().replace(/\s+/g, '');
+    const pluginName = mapping.plugin.name.toLowerCase().replace(/\s+/g, '');
+
+    // Try common naming patterns
+    const patterns = [
+      `${manufacturer}-${pluginName}.json`,
+      `${pluginName}.json`,
+      `${manufacturer}${pluginName}.json`,
+    ];
+
+    for (const pattern of patterns) {
+      const descriptorPath = path.join(descriptorsDir, pattern);
+      if (fs.existsSync(descriptorPath)) {
+        return descriptorPath;
+      }
+    }
+
+    return null;
+  } catch (error) {
+    // Silently skip files that can't be parsed
+    return null;
+  }
+}
+
+function verifyMapping(mapping, fixMode) {
+  const scriptPath = path.join(__dirname, 'ai-verify-mapping.cjs');
+  const args = [
+    scriptPath,
+    mapping.mappingPath,
+    mapping.descriptorPath
+  ];
+
+  if (fixMode) {
+    args.push('--fix');
+  }
+
+  try {
+    const output = execSync(`node ${args.join(' ')}`, {
+      encoding: 'utf8',
+      maxBuffer: 10 * 1024 * 1024
+    });
+
+    // Parse output to extract results
+    const fixedMatch = output.match(/Fixed (\d+) mappings/);
+    const mappedMatch = output.match(/Mapped (\d+) controls/);
+
+    return {
+      success: true,
+      fixed: fixedMatch ? parseInt(fixedMatch[1]) : 0,
+      total: mappedMatch ? parseInt(mappedMatch[1]) : 0,
+      output: output
+    };
+  } catch (error) {
+    return {
+      success: false,
+      error: error.message,
+      output: error.stdout || error.stderr || ''
+    };
+  }
+}
+
+function main() {
+  const args = process.argv.slice(2);
+  const fixMode = args.includes('--fix');
+
+  console.log('\n╔══════════════════════════════════════════════════════════════════════════════════╗');
+  console.log('║                    BATCH CANONICAL MAPPING VERIFICATION                          ║');
+  console.log('╚══════════════════════════════════════════════════════════════════════════════════╝\n');
+
+  if (fixMode) {
+    console.log('🔧 Fix mode enabled - will automatically correct mappings\n');
+  } else {
+    console.log('📋 Verification mode - use --fix to automatically correct mappings\n');
+  }
+
+  console.log('🔍 Scanning for mappings...\n');
+
+  const mappings = findAllMappings();
+
+  if (mappings.length === 0) {
+    console.log('❌ No mappings found\n');
+    process.exit(1);
+  }
+
+  console.log(`Found ${mappings.length} mappings to verify\n`);
+  console.log('─'.repeat(85));
+
+  const results = [];
+  let totalFixed = 0;
+  let totalControls = 0;
+  let failureCount = 0;
+
+  for (let i = 0; i < mappings.length; i++) {
+    const mapping = mappings[i];
+    console.log(`\n[${i + 1}/${mappings.length}] ${mapping.name}`);
+    console.log('─'.repeat(85));
+
+    const result = verifyMapping(mapping, fixMode);
+    results.push({
+      mapping: mapping.name,
+      ...result
+    });
+
+    if (result.success) {
+      console.log(`✓ Verified ${result.total} controls`);
+      if (result.fixed > 0) {
+        console.log(`🔧 Fixed ${result.fixed} mappings`);
+        totalFixed += result.fixed;
+      }
+      totalControls += result.total;
+    } else {
+      console.log(`✗ Failed: ${result.error}`);
+      failureCount++;
+    }
+  }
+
+  // Summary
+  console.log('\n' + '='.repeat(85));
+  console.log('📊 BATCH VERIFICATION SUMMARY');
+  console.log('='.repeat(85) + '\n');
+
+  console.log(`Total mappings processed: ${mappings.length}`);
+  console.log(`Total controls verified:  ${totalControls}`);
+  console.log(`Successful verifications: ${mappings.length - failureCount}`);
+  console.log(`Failed verifications:     ${failureCount}`);
+
+  if (fixMode) {
+    console.log(`Total fixes applied:      ${totalFixed}`);
+  }
+
+  console.log('\n' + '─'.repeat(85));
+
+  // Detailed results
+  if (failureCount > 0) {
+    console.log('\n❌ Failed mappings:');
+    results.filter(r => !r.success).forEach(r => {
+      console.log(`  - ${r.mapping}: ${r.error}`);
+    });
+  }
+
+  if (fixMode && totalFixed > 0) {
+    console.log('\n✅ Mappings fixed:');
+    results.filter(r => r.fixed > 0).forEach(r => {
+      console.log(`  - ${r.mapping}: ${r.fixed} changes`);
+    });
+  }
+
+  console.log('\n' + '='.repeat(85));
+
+  if (failureCount > 0) {
+    console.log('\n❌ Batch verification completed with errors\n');
+    process.exit(1);
+  } else if (fixMode && totalFixed > 0) {
+    console.log(`\n✅ Batch verification complete - ${totalFixed} mappings fixed\n`);
+  } else {
+    console.log('\n✅ Batch verification complete - all mappings correct\n');
+  }
+}
+
+if (require.main === module) {
+  main();
+}
+
+module.exports = { findAllMappings, verifyMapping };


---

_**Agent (claude-sonnet-4-5-20250929)**_

chore(live-max-cc-router): add batch verification script with verify-all and fix-all commands

