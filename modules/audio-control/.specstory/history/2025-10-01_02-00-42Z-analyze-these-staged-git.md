<!-- Generated by SpecStory -->

# 2025-10-01 02:00:42Z

<!-- Claude Code Session e37b0d01-6cad-44f7-9eb3-65b94961e40e (2025-10-01_02-00-42Z) -->

_**User**_

Analyze these staged git changes and output ONLY a single-line conventional commit message (type(scope): description). No explanations.
diff --git a/modules/audio-control/modules/launch-control-xl3/package.json b/modules/audio-control/modules/launch-control-xl3/package.json
index 881fa06..a1239ec 100644
--- a/modules/audio-control/modules/launch-control-xl3/package.json
+++ b/modules/audio-control/modules/launch-control-xl3/package.json
@@ -50,6 +50,10 @@
     "web-automation:actions": "tsx utils/test-web-automation.ts --mode=actions --screenshots",
     "web-automation:full": "tsx utils/test-web-automation.ts --mode=full --screenshots",
     "web-automation:help": "tsx utils/test-web-automation.ts --help",
+    "env:juce-server": "cd ../../../modules/juce/midi-server && make run",
+    "env:midi-spy": "cd ../../../modules/coremidi/midi-snoop && make run",
+    "env:check": "tsx utils/check-test-environment.ts",
+    "env:help": "echo '\nüìã Integration Test Environment Setup:\n\n1. Start JUCE MIDI Server (required):\n   pnpm env:juce-server\n\n2. Start MIDI Spy (optional, for debugging):\n   pnpm env:midi-spy\n\n3. Run integration tests:\n   pnpm test:round-trip:node\n   pnpm backup\n\nServer runs on http://localhost:7777\n'",
     "lint": "eslint . --ext .ts,.tsx",
     "lint:fix": "eslint . --ext .ts,.tsx --fix",
     "typecheck": "tsc --noEmit",
diff --git a/modules/audio-control/modules/launch-control-xl3/utils/backup-current-mode.ts b/modules/audio-control/modules/launch-control-xl3/utils/backup-current-mode.ts
index efd173a..06f8602 100644
--- a/modules/audio-control/modules/launch-control-xl3/utils/backup-current-mode.ts
+++ b/modules/audio-control/modules/launch-control-xl3/utils/backup-current-mode.ts
@@ -10,9 +10,58 @@ import { writeFileSync } from 'fs';
 import { LaunchControlXL3 } from '../src';
 import { JuceMidiBackend } from '../src/backends/JuceMidiBackend';
 
+/**
+ * Check if test environment is ready
+ */
+async function checkEnvironment(): Promise<boolean> {
+  console.log('üîç Checking test environment...');
+
+  try {
+    const response = await fetch('http://localhost:7777/health', { signal: AbortSignal.timeout(2000) });
+    const data = await response.json();
+
+    if (data.status === 'ok') {
+      console.log('‚úì JUCE MIDI server is running');
+      return true;
+    }
+  } catch (error) {
+    console.log('‚úó JUCE MIDI server not running!');
+    console.log();
+    console.log('‚ïê'.repeat(60));
+    console.log('Integration Test Environment Not Ready');
+    console.log('‚ïê'.repeat(60));
+    console.log();
+    console.log('Required setup:');
+    console.log('  1. Start JUCE MIDI server:');
+    console.log('     pnpm env:juce-server');
+    console.log();
+    console.log('  2. Connect Launch Control XL3 via USB');
+    console.log('  3. Power on the device');
+    console.log();
+    console.log('Quick check environment:');
+    console.log('     pnpm env:check');
+    console.log();
+    console.log('For more help:');
+    console.log('     pnpm env:help');
+    console.log();
+    return false;
+  }
+
+  return false;
+}
+
 async function backupCurrentMode() {
   console.log('üîß Backing up current mode from physical slot 1');
   console.log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');
+  console.log();
+
+  // Check environment first
+  const envReady = await checkEnvironment();
+  if (!envReady) {
+    process.exit(1);
+  }
+
+  console.log();
 
   const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
   const physicalSlot = 1;
diff --git a/modules/audio-control/modules/launch-control-xl3/utils/check-test-environment.ts b/modules/audio-control/modules/launch-control-xl3/utils/check-test-environment.ts
new file mode 100644
index 0000000..a4bb100
--- /dev/null
+++ b/modules/audio-control/modules/launch-control-xl3/utils/check-test-environment.ts
@@ -0,0 +1,81 @@
+#!/usr/bin/env tsx
+/**
+ * Check if the integration test environment is properly set up
+ */
+
+import chalk from 'chalk';
+
+async function checkEnvironment(): Promise<boolean> {
+  let allGood = true;
+
+  console.log(chalk.bold('\nüîç Integration Test Environment Check\n'));
+  console.log('‚ïê'.repeat(50));
+
+  // Check 1: JUCE MIDI Server
+  console.log(chalk.cyan('\n1. JUCE MIDI Server (required)'));
+  try {
+    const response = await fetch('http://localhost:7777/health', { signal: AbortSignal.timeout(2000) });
+    const data = await response.json();
+
+    if (data.status === 'ok') {
+      console.log(chalk.green('   ‚úì Server running on http://localhost:7777'));
+
+      // Check for available ports
+      const portsResponse = await fetch('http://localhost:7777/ports');
+      const ports = await portsResponse.json();
+
+      const hasLCXL3 = ports.inputs.some((p: string) => p.includes('LCXL3')) &&
+                       ports.outputs.some((p: string) => p.includes('LCXL3'));
+
+      if (hasLCXL3) {
+        console.log(chalk.green('   ‚úì Launch Control XL3 detected'));
+        console.log(chalk.gray('     Inputs:', ports.inputs.filter((p: string) => p.includes('LCXL3')).join(', ')));
+        console.log(chalk.gray('     Outputs:', ports.outputs.filter((p: string) => p.includes('LCXL3')).join(', ')));
+      } else {
+        console.log(chalk.yellow('   ‚ö† Launch Control XL3 not detected'));
+        console.log(chalk.gray('     Available inputs:', ports.inputs.join(', ')));
+        console.log(chalk.gray('     Available outputs:', ports.outputs.join(', ')));
+        allGood = false;
+      }
+    }
+  } catch (error: any) {
+    console.log(chalk.red('   ‚úó Server not running'));
+    console.log(chalk.yellow('   ‚Üí Start with: pnpm env:juce-server'));
+    allGood = false;
+  }
+
+  // Check 2: Device Connection
+  console.log(chalk.cyan('\n2. Device Connection'));
+  if (allGood) {
+    console.log(chalk.green('   ‚úì Ready for testing'));
+  } else {
+    console.log(chalk.red('   ‚úó Not ready - fix issues above first'));
+  }
+
+  // Summary
+  console.log('\n' + '‚ïê'.repeat(50));
+  if (allGood) {
+    console.log(chalk.green.bold('\n‚úÖ Environment ready for integration tests!\n'));
+    console.log(chalk.cyan('Run tests with:'));
+    console.log(chalk.white('  pnpm test:round-trip:node'));
+    console.log(chalk.white('  pnpm backup'));
+  } else {
+    console.log(chalk.red.bold('\n‚ùå Environment not ready\n'));
+    console.log(chalk.cyan('Setup instructions:'));
+    console.log(chalk.white('  1. Start JUCE server: pnpm env:juce-server'));
+    console.log(chalk.white('  2. Connect Launch Control XL3 via USB'));
+    console.log(chalk.white('  3. Power on the device'));
+    console.log(chalk.white('  4. Re-run this check: pnpm env:check'));
+    console.log(chalk.gray('\nFor help: pnpm env:help'));
+  }
+
+  console.log();
+  return allGood;
+}
+
+checkEnvironment()
+  .then(ready => process.exit(ready ? 0 : 1))
+  .catch(error => {
+    console.error(chalk.red('Environment check failed:'), error.message);
+    process.exit(1);
+  });
diff --git a/modules/audio-control/modules/launch-control-xl3/utils/test-round-trip-node.ts b/modules/audio-control/modules/launch-control-xl3/utils/test-round-trip-node.ts
index ec0599c..a1c318c 100755
--- a/modules/audio-control/modules/launch-control-xl3/utils/test-round-trip-node.ts
+++ b/modules/audio-control/modules/launch-control-xl3/utils/test-round-trip-node.ts
@@ -34,18 +34,18 @@
  *
  * Requirements:
  *   - Launch Control XL 3 device connected via USB
- *   - Native MIDI bindings built successfully (node-midi OR jazz-midi)
- *   - Python 3.11 or earlier + build tools (for native bindings)
+ *   - JUCE MIDI server running on http://localhost:7777
  *   - Device should be powered on and ready
  *
- * IMPORTANT: All Node.js MIDI libraries require native bindings. There is no pure
- * JavaScript solution for Node.js MIDI access. If native bindings fail to build,
- * use the browser test instead.
+ * To start the JUCE MIDI server:
+ *   cd ../../../modules/juce/midi-server
+ *   make run
+ *   # Server will run on http://localhost:7777
  */
 
 import chalk from 'chalk';
 import { LaunchControlXL3 } from '../src';
-import { EasyMidiBackend } from '../src/core/backends/EasyMidiBackend.js';
+import { JuceMidiBackend } from '../src/backends/JuceMidiBackend.js';
 import type { CustomMode, ControlMapping } from '../src/types/CustomMode.js';
 
 // Console formatting helpers
@@ -318,6 +318,46 @@ function compareControlMapping(controlKey: string, sent: ControlMapping, receive
   return { matches, details };
 }
 
+/**
+ * Check if test environment is ready
+ */
+async function checkEnvironment(): Promise<boolean> {
+  log.step('Checking test environment...');
+
+  try {
+    const response = await fetch('http://localhost:7777/health', { signal: AbortSignal.timeout(2000) });
+    const data = await response.json();
+
+    if (data.status === 'ok') {
+      log.success('JUCE MIDI server is running');
+      return true;
+    }
+  } catch (error) {
+    log.error('JUCE MIDI server not running!');
+    console.log();
+    log.warning('‚ïê'.repeat(60));
+    log.warning('Integration Test Environment Not Ready');
+    log.warning('‚ïê'.repeat(60));
+    console.log();
+    log.info('Required setup:');
+    log.info('  1. Start JUCE MIDI server:');
+    console.log(chalk.white('     pnpm env:juce-server'));
+    console.log();
+    log.info('  2. Connect Launch Control XL3 via USB');
+    log.info('  3. Power on the device');
+    console.log();
+    log.info('Quick check environment:');
+    console.log(chalk.white('     pnpm env:check'));
+    console.log();
+    log.info('For more help:');
+    console.log(chalk.white('     pnpm env:help'));
+    console.log();
+    return false;
+  }
+
+  return false;
+}
+
 /**
  * Main round-trip test function
  */
@@ -329,18 +369,26 @@ async function testRoundTrip(): Promise<void> {
   log.data('Target Slot', `${targetSlot} (slot ${targetSlot + 1})`);
   console.log();
 
+  // Check environment first
+  const envReady = await checkEnvironment();
+  if (!envReady) {
+    process.exit(1);
+  }
+
+  console.log();
+
   let controller: LaunchControlXL3 | null = null;
-  let backend: EasyMidiBackend | null = null;
+  let backend: JuceMidiBackend | null = null;
   let testPassed = false;
 
   try {
-    // Step 1: Create and initialize EasyMidiBackend
-    log.step('Creating EasyMidiBackend instance...');
-    backend = new EasyMidiBackend();
+    // Step 1: Create and initialize JuceMidiBackend
+    log.step('Creating JuceMidiBackend instance...');
+    backend = new JuceMidiBackend();
 
-    log.step('Initializing EasyMidiBackend...');
+    log.step('Initializing JuceMidiBackend...');
     await backend.initialize();
-    log.success('EasyMidiBackend initialized successfully!');
+    log.success('JuceMidiBackend initialized successfully!');
 
     // Step 2: Create LaunchControlXL3 instance
     log.step('Creating LaunchControlXL3 instance...');
@@ -492,20 +540,20 @@ async function testRoundTrip(): Promise<void> {
     log.error('Test failed with error:');
     log.error(error.message);
 
-    if (error.message.includes('Cannot find MIDI devices')) {
+    if (error.message.includes('ECONNREFUSED') || error.message.includes('fetch failed')) {
+      log.warning('');
+      log.warning('TROUBLESHOOTING:');
+      log.warning('‚Ä¢ Start the JUCE MIDI server:');
+      log.warning('  cd ../../../modules/juce/midi-server');
+      log.warning('  make run');
+      log.warning('‚Ä¢ Server should be running on http://localhost:7777');
+    } else if (error.message.includes('Cannot find MIDI devices')) {
       log.warning('');
       log.warning('TROUBLESHOOTING:');
       log.warning('‚Ä¢ Ensure Launch Control XL 3 is connected via USB');
       log.warning('‚Ä¢ Check that the device is powered on');
       log.warning('‚Ä¢ Verify MIDI drivers are installed');
       log.warning('‚Ä¢ Try disconnecting and reconnecting the device');
-    } else if (error.message.includes('native bindings')) {
-      log.warning('');
-      log.warning('TROUBLESHOOTING:');
-      log.warning('‚Ä¢ Install Python 3.11 or earlier');
-      log.warning('‚Ä¢ Install build tools: npm install -g node-gyp');
-      log.warning('‚Ä¢ Try: npm rebuild');
-      log.warning('‚Ä¢ Use browser test if native bindings fail');
     }
   } finally {
     // Cleanup
@@ -521,7 +569,7 @@ async function testRoundTrip(): Promise<void> {
 
     if (backend) {
       log.step('Cleaning up MIDI backend...');
-      // EasyMidiBackend doesn't have explicit cleanup, but connections should close
+      // JuceMidiBackend cleanup handled by server
     }
   }
 


---

_**Agent (claude-sonnet-4-5-20250929)**_

test(launch-control-xl3): add environment check utility and integrate JUCE backend verification

