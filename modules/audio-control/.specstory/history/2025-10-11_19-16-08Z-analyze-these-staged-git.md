<!-- Generated by SpecStory -->

# MIDI Controller SysEx Parser Bug Fix Verification (2025-10-11 19:16:08Z)

<!-- Claude Code Session 237f6521-5aaa-497d-9321-fa88ce83a2ee (2025-10-11_19-16-08Z) -->

_**User**_

Analyze these staged git changes and output ONLY a single-line conventional commit message (type(scope): description). No explanations.
diff --git a/modules/audio-control/modules/live-max-cc-router/src/cc-router.ts b/modules/audio-control/modules/live-max-cc-router/src/cc-router.ts
index 1682132..fb812f7 100644
--- a/modules/audio-control/modules/live-max-cc-router/src/cc-router.ts
+++ b/modules/audio-control/modules/live-max-cc-router/src/cc-router.ts
@@ -90,8 +90,12 @@ export class CCRouter {
    */
   private findMapping(ccNumber: number): ParameterMapping | null {
     for (let i = 0; i < this.mappings.length; i++) {
-      if (this.mappings[i].ccNumber === ccNumber) {
-        return this.mappings[i];
+      const mapping = this.mappings[i];
+      if (!mapping) {
+        continue;
+      }
+      if (mapping.ccNumber === ccNumber) {
+        return mapping;
       }
     }
     return null;
@@ -190,7 +194,7 @@ export class CCRouter {
   private transformValue(midiValue: number, mapping: ParameterMapping): number {
     // Normalize to 0-1
     let normalized = midiValue / 127.0;
-    
+
     // Apply curve
     switch (mapping.curve) {
       case 'exponential':
@@ -204,12 +208,12 @@ export class CCRouter {
         // No transformation needed
         break;
     }
-    
+
     // Apply min/max range if specified
     if (mapping.minValue !== undefined && mapping.maxValue !== undefined) {
       normalized = mapping.minValue + (normalized * (mapping.maxValue - mapping.minValue));
     }
-    
+
     return normalized;
   }
 
@@ -218,7 +222,7 @@ export class CCRouter {
    */
   public setMapping(ccNumber: number, deviceIndex: number, parameterIndex: number, parameterName?: string, curve?: 'linear' | 'exponential' | 'logarithmic'): void {
     const existingIndex = this.mappings.findIndex(m => m.ccNumber === ccNumber);
-    
+
     const mapping: ParameterMapping = {
       ccNumber: ccNumber,
       deviceIndex: deviceIndex,
@@ -287,9 +291,17 @@ export class CCRouter {
         // Apply canonical mappings
         const mappingKeys = Object.keys(canonicalMapping.mappings);
         for (let i = 0; i < mappingKeys.length; i++) {
-          const ccNumber = parseInt(mappingKeys[i], 10);
+          const key = mappingKeys[i];
+          if (!key) {
+            throw new Error("Mapping key at index " + i + " is undefined - corrupted mapping data");
+          }
+          const ccNumber = parseInt(key, 10);
           const mapping = canonicalMapping.mappings[ccNumber];
 
+          if (!mapping) {
+            throw new Error("Mapping not found for CC number " + ccNumber + " - invalid mapping data structure");
+          }
+
           this.setMapping(
             ccNumber,
             mapping.deviceIndex,
@@ -348,7 +360,7 @@ export class CCRouter {
   public getSelectedTrackInfo(): TrackInfo | null {
     try {
       const selectedTrack = new LiveAPI("live_set view selected_track");
-      
+
       if (!selectedTrack || selectedTrack.id === "0") {
         return null;
       }
@@ -370,7 +382,7 @@ export class CCRouter {
   public getSelectedTrackDevices(): DeviceInfo[] {
     try {
       const selectedTrack = new LiveAPI("live_set view selected_track");
-      
+
       if (!selectedTrack || selectedTrack.id === "0") {
         return [];
       }
@@ -381,7 +393,7 @@ export class CCRouter {
       for (let i = 0; i < devices.length; i++) {
         const device = new LiveAPI("live_set view selected_track devices " + i);
         const parameters = device.get("parameters");
-        
+
         deviceInfo.push({
           index: i,
           name: device.get("name"),
@@ -405,6 +417,9 @@ export class CCRouter {
 
     for (let i = 0; i < this.mappings.length; i++) {
       const m = this.mappings[i];
+      if (!m) {
+        throw new Error("Mapping at index " + i + " is undefined - corrupted mappings array");
+      }
       logger.info("  CC " + m.ccNumber + " -> Device " + m.deviceIndex + " Param " + m.parameterIndex + " (" + m.curve + ")");
     }
 
@@ -418,4 +433,4 @@ export class CCRouter {
 }
 
 // Export for Max for Live usage
-var ccRouter: CCRouter;
\ No newline at end of file
+var ccRouter: CCRouter;
diff --git a/modules/audio-control/modules/live-max-cc-router/src/max-integration.ts b/modules/audio-control/modules/live-max-cc-router/src/max-integration.ts
index 4a7a34e..13e377f 100644
--- a/modules/audio-control/modules/live-max-cc-router/src/max-integration.ts
+++ b/modules/audio-control/modules/live-max-cc-router/src/max-integration.ts
@@ -76,7 +76,11 @@ function initializeRouter(): void {
   const devices = ccRouter.getSelectedTrackDevices();
   if (devices.length > 0) {
     for (let i = 0; i < devices.length; i++) {
-      logger.info("Device " + i + ": " + devices[i].name + " (" + devices[i].parameterCount + " params)");
+      const device = devices[i];
+      if (!device) {
+        throw new Error(`Device at index ${i} is undefined - invalid device array returned from CCRouter`);
+      }
+      logger.info("Device " + i + ": " + device.name + " (" + device.parameterCount + " params)");
     }
   } else {
     logger.info("No devices found on track");
@@ -168,6 +172,9 @@ function trackinfo(): void {
     const devices = ccRouter.getSelectedTrackDevices();
     for (let i = 0; i < devices.length; i++) {
       const device = devices[i];
+      if (!device) {
+        throw new Error(`Device at index ${i} is undefined - invalid device array returned from CCRouter`);
+      }
       logger.info("  Device " + device.index + ": " + device.name + " (" + device.parameterCount + " parameters)");
     }
   } else {
@@ -210,7 +217,11 @@ function listcontrollers(): void {
   const controllers = ccRouter.getControllers();
   logger.info("=== Available Controllers ===");
   for (let i = 0; i < controllers.length; i++) {
-    logger.info(controllers[i].manufacturer + " " + controllers[i].model);
+    const controller = controllers[i];
+    if (!controller) {
+      throw new Error(`Controller at index ${i} is undefined - invalid controller array returned from CCRouter`);
+    }
+    logger.info(controller.manufacturer + " " + controller.model);
   }
   logger.info("===========================");
 }
@@ -277,4 +288,4 @@ function closebang(): void {
 */
 
 // IMPORTANT: Functions are already declared at top level and accessible to Max v8
-// No need for explicit global assignment - v8 object sees top-level declarations
\ No newline at end of file
+// No need for explicit global assignment - v8 object sees top-level declarations
diff --git a/modules/audio-control/scripts/publish-modules.ts b/modules/audio-control/scripts/publish-modules.ts
index ccb5919..cd0cc4d 100755
--- a/modules/audio-control/scripts/publish-modules.ts
+++ b/modules/audio-control/scripts/publish-modules.ts
@@ -63,11 +63,7 @@ function publishModules(dryRun: boolean = false) {
   execCommand('pnpm build', rootDir);
 
   console.log('\nStep 2: Run tests');
-  try {
-    execCommand('pnpm test', rootDir);
-  } catch (error) {
-    console.log('⚠️  Some modules have no tests, continuing...');
-  }
+  execCommand('pnpm test', rootDir);
 
   console.log('\nStep 3: Type check');
   execCommand('pnpm typecheck', rootDir);
diff --git a/modules/audio-control/scripts/release.ts b/modules/audio-control/scripts/release.ts
index d5fbf43..c804afb 100755
--- a/modules/audio-control/scripts/release.ts
+++ b/modules/audio-control/scripts/release.ts
@@ -91,13 +91,26 @@ function release() {
   const bumpType = process.argv[2];
   const dryRun = process.argv.includes('--dry-run');
 
-  if (!bumpType || !['major', 'minor', 'patch'].includes(bumpType)) {
-    console.error('Usage: pnpm release <major|minor|patch> [--dry-run]');
-    console.error('\nExample:');
-    console.error('  pnpm release patch            # 1.0.1 → 1.0.2');
-    console.error('  pnpm release minor            # 1.0.1 → 1.1.0');
-    console.error('  pnpm release major            # 1.0.1 → 2.0.0');
-    console.error('  pnpm release minor --dry-run  # Test release without changes');
+  // Check for --preid flag
+  const preidIndex = process.argv.indexOf('--preid');
+  const prereleaseId = preidIndex !== -1 && process.argv[preidIndex + 1]
+    ? process.argv[preidIndex + 1]
+    : 'alpha';
+
+  const validBumpTypes = ['major', 'minor', 'patch', 'premajor', 'preminor', 'prepatch', 'prerelease'];
+
+  if (!bumpType || !validBumpTypes.includes(bumpType)) {
+    console.error('Usage: pnpm release <major|minor|patch|premajor|preminor|prepatch|prerelease> [--preid <id>] [--dry-run]');
+    console.error('\nStable releases:');
+    console.error('  pnpm release patch                    # 1.20.0 → 1.20.1');
+    console.error('  pnpm release minor                    # 1.20.0 → 1.21.0');
+    console.error('  pnpm release major                    # 1.20.0 → 2.0.0');
+    console.error('\nPre-releases:');
+    console.error('  pnpm release prepatch                 # 1.20.0 → 1.20.1-alpha.0');
+    console.error('  pnpm release prepatch --preid beta    # 1.20.0 → 1.20.1-beta.0');
+    console.error('  pnpm release prerelease               # 1.20.0-alpha.0 → 1.20.0-alpha.1');
+    console.error('\nOther:');
+    console.error('  pnpm release minor --dry-run          # Test release without changes');
     process.exit(1);
   }
 
@@ -110,7 +123,8 @@ function release() {
   }
 
   console.log('Step 1: Bump version');
-  execCommand(`tsx scripts/bump-version.ts ${bumpType}${dryRun ? ' --dry-run' : ''}`, rootDir);
+  const preidFlag = prereleaseId !== 'alpha' ? ` --preid ${prereleaseId}` : '';
+  execCommand(`tsx scripts/bump-version.ts ${bumpType}${preidFlag}${dryRun ? ' --dry-run' : ''}`, rootDir);
 
   const version = getVersion(rootDir);
   const modules = getPublishedModules(rootDir);
@@ -144,4 +158,4 @@ function release() {
   console.log(`✓ Created GitHub release: audio-control@${version}`);
 }
 
-release();
\ No newline at end of file
+release();


---

_**Agent (claude-sonnet-4-5-20250929)**_

fix(live-max-cc-router): add null checks for array iterations and strict prerelease support

