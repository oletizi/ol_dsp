<!-- Generated by SpecStory -->

# LaunchControl XL3 Library: MIDI Mode Transfer Test (2025-10-10 05:56:00Z)

<!-- Claude Code Session 091ecf54-d780-4480-8d99-fdae864ac740 (2025-10-10_05-56-00Z) -->

_**User**_

Analyze these staged git changes and output ONLY a single-line conventional commit message (type(scope): description). No explanations.
diff --git a/modules/audio-control/modules/launch-control-xl3/package.json b/modules/audio-control/modules/launch-control-xl3/package.json
index c3dd007..09db6c6 100644
--- a/modules/audio-control/modules/launch-control-xl3/package.json
+++ b/modules/audio-control/modules/launch-control-xl3/package.json
@@ -42,6 +42,7 @@
     "test:handshake:node": "tsx utils/test-handshake-node.ts",
     "test:fetch-mode:node": "tsx utils/test-fetch-custom-mode-node.ts",
     "test:round-trip:node": "tsx utils/test-round-trip-node.ts",
+    "test:slot-copy": "tsx utils/test-slot-copy.ts",
     "test:factory-copy": "tsx utils/test-factory-mode-copy.ts",
     "test:control-name": "tsx utils/test-control-name-send.ts",
     "test:simple-write": "tsx utils/test-simple-write.ts",
diff --git a/modules/audio-control/modules/launch-control-xl3/src/cli/cli.ts b/modules/audio-control/modules/launch-control-xl3/src/cli/cli.ts
index 746076c..48efba3 100644
--- a/modules/audio-control/modules/launch-control-xl3/src/cli/cli.ts
+++ b/modules/audio-control/modules/launch-control-xl3/src/cli/cli.ts
@@ -7,7 +7,9 @@
  */
 
 import { Command } from 'commander';
+import { readFile } from 'fs/promises';
 import { LaunchControlXL3 } from '../LaunchControlXL3.js';
+import type { CustomMode } from '../types/CustomMode.js';
 
 const program = new Command();
 const VERSION = '0.1.0';
@@ -153,10 +155,54 @@ program
     }
   });
 
+// Write mode command
+program
+  .command('write-mode <slot> <file>')
+  .description('Write custom mode to slot (0-15) from JSON file')
+  .action(async (slot: string, file: string) => {
+    try {
+      const ctrl = await connect();
+      const slotNum = parseInt(slot, 10);
+
+      // Validate slot number
+      if (isNaN(slotNum) || slotNum < 0 || slotNum > 15) {
+        console.error('Slot must be 0-15');
+        process.exit(1);
+      }
+
+      // Read JSON file
+      console.log(`Reading mode from ${file}...`);
+      let fileContent: string;
+      try {
+        fileContent = await readFile(file, 'utf-8');
+      } catch (error) {
+        console.error(`Failed to read file: ${(error as Error).message}`);
+        process.exit(1);
+      }
+
+      // Parse JSON
+      let mode: CustomMode;
+      try {
+        mode = JSON.parse(fileContent) as CustomMode;
+      } catch (error) {
+        console.error(`Failed to parse JSON: ${(error as Error).message}`);
+        process.exit(1);
+      }
+
+      // Write mode to device
+      console.log(`Writing mode to slot ${slotNum}...`);
+      await ctrl.writeCustomMode(slotNum, mode);
+      console.log(`‚úì Mode written successfully`);
+    } catch (error) {
+      console.error(`Error: ${(error as Error).message}`);
+      process.exit(1);
+    }
+  });
+
 // Parse arguments
 program.parse();
 
 // Show help if no command
 if (!process.argv.slice(2).length) {
   program.outputHelp();
-}
\ No newline at end of file
+}
diff --git a/modules/audio-control/modules/launch-control-xl3/utils/backup-current-mode.ts b/modules/audio-control/modules/launch-control-xl3/utils/backup-current-mode.ts
index 06f8602..a569aea 100644
--- a/modules/audio-control/modules/launch-control-xl3/utils/backup-current-mode.ts
+++ b/modules/audio-control/modules/launch-control-xl3/utils/backup-current-mode.ts
@@ -1,12 +1,13 @@
 #!/usr/bin/env npx tsx
 /**
- * Backup Current Mode from Physical Slot 1
+ * Backup Current Mode from Physical Slot
  *
- * Reads the current mode from physical slot 1 and stores it in both JSON and
+ * Reads the current mode from a specified physical slot (1-16) and stores it in both JSON and
  * TypeScript format for later restoration using the library's built-in functions.
  */
 
 import { writeFileSync } from 'fs';
+import { Command } from 'commander';
 import { LaunchControlXL3 } from '../src';
 import { JuceMidiBackend } from '../src/backends/JuceMidiBackend';
 
@@ -50,8 +51,8 @@ async function checkEnvironment(): Promise<boolean> {
   return false;
 }
 
-async function backupCurrentMode() {
-  console.log('üîß Backing up current mode from physical slot 1');
+async function backupCurrentMode(physicalSlot: number) {
+  console.log(`üîß Backing up current mode from physical slot ${physicalSlot}`);
   console.log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');
   console.log();
 
@@ -64,7 +65,6 @@ async function backupCurrentMode() {
   console.log();
 
   const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
-  const physicalSlot = 1;
   const apiSlot = physicalSlot - 1; // API uses 0-based indexing
 
   // Create device with JUCE backend
@@ -234,5 +234,28 @@ function generateBuilderCode(mode: any): string {
   return lines.join('\\n');
 }
 
+// Parse command line arguments
+const program = new Command();
+
+program
+  .name('backup-current-mode')
+  .description('Backup current mode from Launch Control XL3 physical slot')
+  .option('-s, --slot <number>', 'Physical slot number (1-16)', '1')
+  .parse(process.argv);
+
+const options = program.opts();
+const physicalSlot = parseInt(options.slot, 10);
+
+// Validate slot number
+if (isNaN(physicalSlot) || physicalSlot < 1 || physicalSlot > 16) {
+  console.error('‚ùå Error: Slot must be a number between 1 and 16');
+  console.log('');
+  console.log('Usage:');
+  console.log('  pnpm backup           # defaults to slot 1');
+  console.log('  pnpm backup --slot 2  # backs up slot 2');
+  console.log('  pnpm backup -s 15     # backs up slot 15');
+  process.exit(1);
+}
+
 // Run the backup
-backupCurrentMode().catch(console.error);
\ No newline at end of file
+backupCurrentMode(physicalSlot).catch(console.error);
diff --git a/modules/audio-control/modules/launch-control-xl3/utils/test-slot-copy.ts b/modules/audio-control/modules/launch-control-xl3/utils/test-slot-copy.ts
new file mode 100644
index 0000000..58bd0ba
--- /dev/null
+++ b/modules/audio-control/modules/launch-control-xl3/utils/test-slot-copy.ts
@@ -0,0 +1,190 @@
+#!/usr/bin/env npx tsx
+/**
+ * Test: Copy from slot 0 to slot 7 and verify
+ *
+ * 1. Read from slot 0 (first slot)
+ * 2. Write to slot 7 (8th slot)
+ * 3. Read back from slot 7
+ * 4. Verify they match
+ */
+
+import { LaunchControlXL3 } from '../src';
+import { JuceMidiBackend } from '../src/backends/JuceMidiBackend';
+
+async function checkEnvironment(): Promise<boolean> {
+  console.log('üîç Checking test environment...');
+
+  try {
+    const response = await fetch('http://localhost:7777/health', { signal: AbortSignal.timeout(2000) });
+    const data = await response.json();
+
+    if (data.status === 'ok') {
+      console.log('‚úì JUCE MIDI server is running');
+      return true;
+    }
+  } catch (error) {
+    console.log('‚úó JUCE MIDI server not running!');
+    console.log('\nPlease start the JUCE MIDI server:');
+    console.log('  pnpm env:juce-server\n');
+    return false;
+  }
+
+  return false;
+}
+
+async function testSlotCopy() {
+  console.log('Launch Control XL3 - Slot Copy Test');
+  console.log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n');
+
+  // Check environment
+  const envReady = await checkEnvironment();
+  if (!envReady) {
+    process.exit(1);
+  }
+
+  console.log();
+
+  const sourceSlot = 0; // First slot
+  const targetSlot = 7; // 8th slot
+
+  const backend = new JuceMidiBackend({ host: 'localhost', port: 7777 });
+  const device = new LaunchControlXL3({ midiBackend: backend });
+
+  try {
+    // Connect
+    console.log('üîå Connecting to device...');
+    await device.connect();
+    console.log('‚úì Connected\n');
+
+    // Step 1: Read from slot 0
+    console.log(`üìñ Step 1: Reading from slot ${sourceSlot} (physical slot ${sourceSlot + 1})...`);
+    const sourceMode = await device.readCustomMode(sourceSlot);
+
+    if (!sourceMode) {
+      console.log(`‚ùå No mode found in slot ${sourceSlot}`);
+      process.exit(1);
+    }
+
+    console.log(`‚úì Read mode: "${sourceMode.name}"`);
+    console.log(`  Controls: ${Object.keys(sourceMode.controls).length}`);
+    console.log();
+
+    // Step 2: Write to slot 7
+    console.log(`üìù Step 2: Writing to slot ${targetSlot} (physical slot ${targetSlot + 1})...`);
+    await device.writeCustomMode(targetSlot, sourceMode);
+    console.log('‚úì Write completed');
+    console.log();
+
+    // Wait for device to process
+    console.log('‚è±Ô∏è  Waiting 1 second for device to process...');
+    await new Promise(resolve => setTimeout(resolve, 1000));
+    console.log();
+
+    // Step 3: Read back from slot 7
+    console.log(`üìñ Step 3: Reading back from slot ${targetSlot}...`);
+    const targetMode = await device.readCustomMode(targetSlot);
+
+    if (!targetMode) {
+      console.log(`‚ùå No mode found in slot ${targetSlot}`);
+      process.exit(1);
+    }
+
+    console.log(`‚úì Read mode: "${targetMode.name}"`);
+    console.log(`  Controls: ${Object.keys(targetMode.controls).length}`);
+    console.log();
+
+    // Step 4: Verify they match
+    console.log('üîç Step 4: Verifying data integrity...');
+    console.log('‚îÄ'.repeat(50));
+
+    const errors: string[] = [];
+
+    // Check name
+    if (sourceMode.name !== targetMode.name) {
+      errors.push(`Name mismatch: "${sourceMode.name}" != "${targetMode.name}"`);
+    } else {
+      console.log(`‚úì Name matches: "${sourceMode.name}"`);
+    }
+
+    // Check control count
+    const sourceControlCount = Object.keys(sourceMode.controls).length;
+    const targetControlCount = Object.keys(targetMode.controls).length;
+
+    if (sourceControlCount !== targetControlCount) {
+      errors.push(`Control count mismatch: ${sourceControlCount} != ${targetControlCount}`);
+    } else {
+      console.log(`‚úì Control count matches: ${sourceControlCount}`);
+    }
+
+    // Check individual controls
+    let controlMatches = 0;
+    let controlMismatches = 0;
+
+    for (const [controlId, sourceControl] of Object.entries(sourceMode.controls)) {
+      const targetControl = targetMode.controls[controlId];
+
+      if (!targetControl) {
+        controlMismatches++;
+        errors.push(`Control ${controlId} missing in target`);
+        continue;
+      }
+
+      // Compare control properties
+      const sourceCtrl = sourceControl as any;
+      const targetCtrl = targetControl as any;
+
+      if (sourceCtrl.midiChannel !== targetCtrl.midiChannel ||
+          sourceCtrl.ccNumber !== targetCtrl.ccNumber ||
+          sourceCtrl.behavior !== targetCtrl.behavior) {
+        controlMismatches++;
+        errors.push(`Control ${controlId} data mismatch`);
+      } else {
+        controlMatches++;
+      }
+    }
+
+    console.log(`‚úì Matching controls: ${controlMatches}/${sourceControlCount}`);
+
+    if (controlMismatches > 0) {
+      console.log(`‚úó Mismatched controls: ${controlMismatches}`);
+    }
+
+    console.log();
+
+    // Final result
+    if (errors.length === 0) {
+      console.log('‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó');
+      console.log('‚ïë                                               ‚ïë');
+      console.log('‚ïë            ‚úÖ TEST PASSED                     ‚ïë');
+      console.log('‚ïë                                               ‚ïë');
+      console.log('‚ïë  Slot copy and verification successful!      ‚ïë');
+      console.log('‚ïë                                               ‚ïë');
+      console.log('‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù');
+      console.log();
+      console.log(`Slot ${sourceSlot} successfully copied to slot ${targetSlot}`);
+      console.log('Data integrity verified - all controls match!');
+    } else {
+      console.log('‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó');
+      console.log('‚ïë                                               ‚ïë');
+      console.log('‚ïë            ‚ùå TEST FAILED                     ‚ïë');
+      console.log('‚ïë                                               ‚ïë');
+      console.log('‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù');
+      console.log();
+      console.log('Errors found:');
+      errors.forEach(error => console.log(`  ‚úó ${error}`));
+      process.exit(1);
+    }
+
+  } catch (error) {
+    console.error('\n‚ùå Test failed:', error instanceof Error ? error.message : String(error));
+    throw error;
+  } finally {
+    console.log('\nüßπ Cleaning up...');
+    await device.disconnect();
+    await backend.close();
+    console.log('‚úì Done');
+  }
+}
+
+// Run the test
+testSlotCopy().catch(console.error);


---

_**Agent (claude-sonnet-4-5-20250929)**_

```
feat(cli): add slot selection and write-mode command
```

